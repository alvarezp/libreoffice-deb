#!/bin/sh

# preinst script for openoffice.org-common

THIS_PACKAGE=openoffice.org-common
THIS_SCRIPT=preinst

set -e

#INCLUDE_SHELL_LIB#

case "$1" in install|upgrade)
	if dpkg --compare-versions "$2" lt "2.0.0-2"; then
		rm_conffile "/etc/bash_completion.d/openoffice" $THIS_PACKAGE
		rm_conffile "/etc/openoffice/autoresponse.conf" $THIS_PACKAGE
		rm_conffile "/etc/openoffice/openoffice.conf" $THIS_PACKAGE
	fi
	if dpkg --compare-versions "$2" lt "2.0.2-2"; then
		rm_conffile "/etc/bash_completion.d/ooo-wrapper.sh" $THIS_PACKAGE
	fi
	# obsolete. no conffile.
	rm -f /etc/openoffice/dictionary.lst /etc/openoffice/dictionary.lst-old
	
	# try to recover. No idea whether that completely helps but it
	# at least gets the bogus dir away.
	if [ -e /usr/lib/openoffice/basis-link -a \
		! -L /usr/lib/openoffice/basis-link ] && \
		[ -e /usr/lib/openoffice/basis-link/share/config/javasettingsunopkginstall.xml ]; then
		rm -f /usr/lib/openoffice/basis-link/share/config/javasettingsunopkginstall.xml
		rmdir --ignore-fail-on-non-empty /usr/lib/openoffice/basis-link/share/config
		rmdir --ignore-fail-on-non-empty /usr/lib/openoffice/basis-link/share
		rmdir --ignore-fail-on-non-empty /usr/lib/openoffice/basis-link
	fi

	# move a already-filled in javasettingsunopkginstall.xml to the new
 	# location on upgrades
	if [ ! -e `echo /@OOBASISDIR@ | sed -e s/usr/var/`/share/config/javasettingsunopkginstall.xml ]; then
		if [ ! -d `echo /@OOBASISDIR@ | sed -e s/usr/var/`/share/config ]; then
			mkdir -p `echo /@OOBASISDIR@ | sed -e s/usr/var/`/share/config
		fi
		if [ -e /var/lib/openoffice/javasettingsunopkginstall.xml ]; then
			mv /var/lib/openoffice/javasettingsunopkginstall.xml \
				 `echo /@OOBASISDIR@ | sed -e s/usr/var/`/share/config/javasettingsunopkginstall.xml
		fi
		if [ -e /var/lib/openoffice/share/config/javasettingsunopkginstall.xml ]; then
			mv /var/lib/openoffice/share/config/javasettingsunopkginstall.xml \
				 `echo /@OOBASISDIR@ | sed -e s/usr/var/`/share/config/javasettingsunopkginstall.xml
		fi
	else
		rm -f /var/lib/openoffice/javasettingsunopkginstall.xml
		rm -f /var/lib/openoffice/share/config/javasettingsunopkginstall.xml
	fi
	;;
esac

#DEBHELPER#

exit 0
