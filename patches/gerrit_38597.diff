From: Szymon KÅ‚os <szymon.klos@collabora.com>
Date: Fri, 9 Jun 2017 09:10:28 +0000 (+0200)
Subject: Watermark: reuse existing rotation property
X-Git-Url: https://gerrit.libreoffice.org/gitweb?p=core.git;a=commitdiff_plain;h=92335d5b39d186da44f032da5ad74c8a8b962092

Watermark: reuse existing rotation property

Change-Id: I0cade407883a60d8d802b487668882e95f42ddce
---

diff --git a/sw/source/core/edit/edfcol.cxx b/sw/source/core/edit/edfcol.cxx
index 8d6965c..6f73f82 100644
--- a/sw/source/core/edit/edfcol.cxx
+++ b/sw/source/core/edit/edfcol.cxx
@@ -302,7 +302,7 @@ SfxWatermarkItem SwEditShell::GetWatermark()
             sal_uInt32 nColor;
             sal_Int16 nTransparency;
             OUString aFont;
-            drawing::HomogenMatrix3 aMatrix;
+            sal_Int64 nAngle;
 
             aItem.SetText(xTextRange->getString());
 
@@ -310,14 +310,8 @@ SfxWatermarkItem SwEditShell::GetWatermark()
                 aItem.SetFont(aFont);
             if (xPropertySet->getPropertyValue(UNO_NAME_FILLCOLOR) >>= nColor)
                 aItem.SetColor(nColor);
-            if (xPropertySet->getPropertyValue("Transformation") >>= aMatrix)
-            {
-                double y = aMatrix.Line2.Column1;
-                double x = aMatrix.Line1.Column1;
-                double nRad = atan2(y, x) * -1;
-                double nDeg = nRad * 180.0 / F_PI;
-                aItem.SetAngle(nDeg);
-            }
+            if (xPropertySet->getPropertyValue("RotateAngle") >>= nAngle)
+                aItem.SetAngle(nAngle / 100);
             if (xPropertySet->getPropertyValue(UNO_NAME_FILL_TRANSPARENCE) >>= nTransparency)
                 aItem.SetTransparency(nTransparency);
 
@@ -366,18 +360,15 @@ void SwEditShell::SetWatermark(const SfxWatermarkItem& rWatermark)
             drawing::HomogenMatrix3 aMatrix;
             sal_uInt32 nColor = 0xc0c0c0;
             sal_Int16 nTransparency = 50;
-            sal_Int16 nAngle = 45;
+            sal_Int64 nAngle = 45;
             OUString aFont = "";
 
             uno::Reference<beans::XPropertySet> xPropertySet(xWatermark, uno::UNO_QUERY);
             xPropertySet->getPropertyValue(UNO_NAME_CHAR_FONT_NAME) >>= aFont;
             xPropertySet->getPropertyValue(UNO_NAME_FILLCOLOR) >>= nColor;
             xPropertySet->getPropertyValue(UNO_NAME_FILL_TRANSPARENCE) >>= nTransparency;
-            xPropertySet->getPropertyValue("Transformation") >>= aMatrix;
-            double y = aMatrix.Line2.Column1;
-            double x = aMatrix.Line1.Column1;
-            double nRad = atan2(y, x) * -1;
-            nAngle = nRad * 180.0 / F_PI;
+            xPropertySet->getPropertyValue("RotateAngle") >>= nAngle;
+            nAngle /= 100;
 
             // If the header already contains a watermark, see if it its text is up to date.
             uno::Reference<text::XTextRange> xTextRange(xWatermark, uno::UNO_QUERY);
