--- /dev/null	2010-06-21 14:50:44.132270648 +0200
+++ openoffice.org-3.3.0~dev300m83/ooo-build-3-2-99-1/patches/dev300/junit-needs-hamcrest.diff	2010-06-23 16:41:10.000000000 +0200
@@ -0,0 +1,53 @@
+diff --git a/configure.in b/configure.in
+--- configure.in
++++ configure.in
+@@ -6740,6 +6740,37 @@
+ location (/usr/share/java), specify its pathname via
+ --with-junit=..., or disable it via --without-junit])
+     fi
++
++    AC_MSG_CHECKING([whether $OOO_JUNIT_JAR has working org.hamcrest.SelfDescribing])
++    "$JAVA_HOME/bin/jar" tf "$OOO_JUNIT_JAR" 2>&5 | \
++	grep org/hamcrest/SelfDescribing.class > /dev/null 2>&5
++    if test $? -eq 0; then
++	AC_MSG_RESULT([yes])
++    else
++	# check whether we have it in Class-Path:
++        export OOO_JUNIT_JAR
++        if $PERL -e 'use Archive::Zip;
++            my $file = "$ENV{'OOO_JUNIT_JAR'}";
++            my $zip = Archive::Zip->new( $file );
++            my $mf = $zip->contents ( "META-INF/MANIFEST.MF" );
++            if ( $mf =~ m/Class-Path:.*hamcrest/ ) {
++                exit 0;
++            } else {
++                exit 1;
++            }'; then
++            AC_MSG_RESULT([yes])
++         else
++            AC_MSG_RESULT([no])
++	    if test -n "$with_hamcrest_core_jar"; then
++		OOO_HAMCREST_CORE_JAR=$with_hamcrest_core_jar
++	    else
++		# try to deduct from junits location
++		OOO_HAMCREST_CORE_JAR=`dirname $OOO_JUNIT_JAR`/hamcrest-core.jar
++	    fi
++	    AC_CHECK_FILE([$OOO_HAMCREST_CORE_JAR], [], [AC_MSG_ERROR(hamcrest-core.jar not found. Install or specify location with --with-hamcrest-core-jar)])
++            OOO_JUNIT_JAR="$OOO_JUNIT_JAR $OOO_HAMCREST_CORE_JAR"
++         fi
++    fi
+ fi
+ AC_SUBST(OOO_JUNIT_JAR)
+ 
+diff --git a/solenv/inc/installationtest.mk b/solenv/inc/installationtest.mk
+--- solenv/inc/installationtest.mk
++++ solenv/inc/installationtest.mk
+@@ -114,7 +114,7 @@
+     $(RM) -r $(MISC)/$(TARGET)/user
+     $(MKDIRHIER) $(MISC)/$(TARGET)/user
+     $(JAVAI) $(JAVAIFLAGS) $(JAVACPS) \
+-        '$(OOO_JUNIT_JAR)$(PATH_SEPERATOR)$(CLASSPATH)' \
++        '$(subst,%Z*Z%,$(PATH_SEPERATOR) $(OOO_JUNIT_JAR:s//%Z*Z%/))$(PATH_SEPERATOR)$(CLASSPATH)' \
+         -Dorg.openoffice.test.arg.soffice=$(my_soffice) \
+         -Dorg.openoffice.test.arg.user=$(my_file)$(PWD)/$(MISC)/$(TARGET)/user \
+         $(my_javaenv) org.junit.runner.JUnitCore \
diff --git a/patches/dev300/apply b/patches/dev300/apply
index df205d4..a397d8e 100644
--- openoffice.org-3.3.0~dev300m83/ooo-build-3-2-99-1/patches/dev300/apply
+++ openoffice.org-3.3.0~dev300m83/ooo-build-3-2-99-1/patches/dev300/apply
@@ -2524,6 +2524,9 @@ unit-sc.diff
 # experimental unit testing using writer core
 # unittesting-more-sw.diff, thorsten
 
+[ UnitTesting ]
+junit-needs-hamcrest.diff, i#112631, rengelha
+
 [ Features ]
 novell-win32-odma.diff, i#6885, i#32741, tml
 
