From eb0524839521e563ed8f9fc17a8117a0cf74da34 Mon Sep 17 00:00:00 2001
From: Rene Engelhard <rene@debian.org>
Date: Fri, 27 Apr 2018 12:11:34 +0200
Subject: build-examples_common.mk: quote gb_Output_announce to not announce it
 to early

Change-Id: I2f515b0647db020179374c66b8ff756e250665b2
Reviewed-on: https://gerrit.libreoffice.org/53559
Tested-by: Jenkins <ci@libreoffice.org>
Reviewed-by: Rene Engelhard <rene@debian.org>
---
 odk/build-examples_common.mk | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/odk/build-examples_common.mk b/odk/build-examples_common.mk
index c0142d3c..c0c5e0e 100644
--- a/odk/build-examples_common.mk
+++ b/odk/build-examples_common.mk
@@ -7,7 +7,7 @@ $(call gb_CustomTarget_get_target,$(1)): \
 ifneq ($(gb_SUPPRESS_TESTS),)
 	@true
 else
-	$(call gb_Output_announce,$(subst $(WORKDIR)/,,$(1)),$(true),CHK,1)
+	$$(call gb_Output_announce,$(subst $(WORKDIR)/,,$(1)),$(true),CHK,1)
 	rm -fr $(call gb_CustomTarget_get_workdir,$(1))/{out,user}
 ifeq (MACOSX,$(OS))
 	$(eval ODK_BUILD_SHELL := $(shell $(gb_MKTEMP)))
@@ -37,7 +37,7 @@ $(call gb_CustomTarget_get_workdir,$(1))/setsdkenv: \
 	$(SRCDIR)/odk/config/setsdkenv_unix.sh.in \
 	$(BUILDDIR)/config_$(gb_Side).mk | \
 	$(call gb_CustomTarget_get_workdir,$(1))/.dir
-	$(call gb_Output_announce,$(subst $(WORKDIR)/,,$(1)),$(true),SED,1)
+	$$(call gb_Output_announce,$(subst $(WORKDIR)/,,$(1)),$(true),SED,1)
 	sed -e 's!@OO_SDK_NAME@!sdk!' \
 	-e 's!@OO_SDK_HOME@!$(INSTDIR)/$(SDKDIRNAME)!' \
 	-e 's!@OFFICE_HOME@!$(INSTROOTBASE)!' -e 's!@OO_SDK_MAKE_HOME@!!' \
-- 
cgit v1.1

From fb0a81d04cc4b425bbd7dd9b8e32d8d9b6c3bc4e Mon Sep 17 00:00:00 2001
From: Rene Engelhard <rene@debian.org>
Date: Fri, 27 Apr 2018 10:20:05 +0200
Subject: add a second argument to the odk_build-examples_test "template"

... as two times my_example_dirs (probably) runs into the same
"global variable" issue like with testname=

Change-Id: I40dcff8e1e01c0cf557143432003bd9d8787bce1
Reviewed-on: https://gerrit.libreoffice.org/53553
Reviewed-by: Michael Stahl <Michael.Stahl@cib.de>
Tested-by: Jenkins <ci@libreoffice.org>
---
 odk/CustomTarget_build-examples.mk      | 2 +-
 odk/CustomTarget_build-examples_java.mk | 4 ++--
 odk/build-examples_common.mk            | 2 +-
 3 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/odk/CustomTarget_build-examples.mk b/odk/CustomTarget_build-examples.mk
index c72efef..de3e965 100644
--- a/odk/CustomTarget_build-examples.mk
+++ b/odk/CustomTarget_build-examples.mk
@@ -29,6 +29,6 @@ my_example_dirs = \
 #    cpp/custompanel \
 
 
-$(eval $(call odk_build-examples_test,odk/build-examples))
+$(eval $(call odk_build-examples_test,odk/build-examples,$(my_example_dirs)))
 
 # vim: set noet sw=4 ts=4:
diff --git a/odk/CustomTarget_build-examples_java.mk b/odk/CustomTarget_build-examples_java.mk
index 6d77ac5..f494296 100644
--- a/odk/CustomTarget_build-examples_java.mk
+++ b/odk/CustomTarget_build-examples_java.mk
@@ -7,7 +7,7 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 #
 
-my_example_dirs = \
+my_example_dirs_java = \
     DevelopersGuide/BasicAndDialogs/CreatingDialogs \
     DevelopersGuide/Charts \
     DevelopersGuide/Components/Addons/JobsAddon \
@@ -57,6 +57,6 @@ my_example_dirs = \
 #    java/NotesAccess \
 #    java/Storage \
 
-$(eval $(call odk_build-examples_test,odk/build-examples_java))
+$(eval $(call odk_build-examples_test,odk/build-examples_java,$(my_example_dirs_java)))
 
 # vim: set noet sw=4 ts=4:
diff --git a/odk/build-examples_common.mk b/odk/build-examples_common.mk
index c0c5e0e..1f07208 100644
--- a/odk/build-examples_common.mk
+++ b/odk/build-examples_common.mk
@@ -19,7 +19,7 @@ endif
 	    && $(gb_Helper_LIBRARY_PATH_VAR)=$$saved_library_path) \
 	&& export \
 	    UserInstallation=$(call gb_Helper_make_url,$(call gb_CustomTarget_get_workdir,$(1))/user) \
-	$(foreach my_dir,$(my_example_dirs), \
+	$(foreach my_dir,$(2), \
 	    && (cd $(INSTDIR)/$(SDKDIRNAME)/examples/$(my_dir) \
 		&& printf 'yes\n' | LC_ALL=C make \
 		    $(if $(filter MACOSX,$(OS)), SHELL=$(ODK_BUILD_SHELL), )))) \
-- 
cgit v1.1

